<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>learnPhaser</title>
    <script src="phaser/phaser.js"></script>
    <script src="js/boot.js"></script>
    <script src="js/loader.js"></script>

    <style>
        @font-face {
            font-family: 'fzhyt';
            src: url("res/活一体字体.TTF");
        }
    </style>
</head>
<body>
    <h1 style="font-family: fzhyt">LearnPhaser</h1>
    <div id="div_phaser" style="width: 1000px;height: 1000px;border: 1px solid red"></div>

    <script>
        var game = new Phaser.Game(400,400,Phaser.CANVAS,'div_phaser');

        var player;
        var cursors;
        var layer;

        function state() {
            this.init = function(){
                game.scale.pageAlignHorizontally = true;    //水平居中
                game.scale.pageAlignVertically = true;      //垂直居中


            },
            this.preload = function(){
                game.load.image('backgroud','res/backgroud.png');
                game.load.image('cat','res/cat.jpg');
                game.load.spritesheet('sprite', 'res/a1.png', 32, 32);
                game.load.bitmapFont('font','res/font.png','res/font.fnt')
                game.load.atlasXML('man','res/r.png','res/r.xml');

                game.load.tilemap('mario_map', 'res/mario.json',null,Phaser.Tilemap.TILED_JSON);
                game.load.image('mario','res/mario.png');
                game.load.image('player','res/player.png');//玩家
                game.load.audio('foo','res/music.mp3');


            },
            this.create = function(){
                var map = game.add.tilemap('mario_map');
                map.addTilesetImage('mario', 'mario');//1 合集图片名称 2加载图片名称
                layer = map.createLayer('world');//tiled 图层名

                layer.resizeWorld();//调整世界大小为地图大小

                map.setCollisionBetween(15,16); //设置碰撞的图范围 资源图索引
                map.setCollisionBetween(20,25);
                map.setCollisionBetween(27,29);
                map.setCollision(40);   //设置碰撞的图 资源图索引

                game.physics.startSystem(Phaser.Physics.ARCADE);
                player = game.add.sprite(32, 32, 'player');
                game.physics.enable(player);
                game.physics.arcade.gravity.y = 250;
                player.body.bounce.y = 0.2;
                game.camera.follow(player);

                cursors = game.input.keyboard.createCursorKeys();
                var sound = game.add.audio('foo');
                sound.play();
            },
            this.update = function(){
                game.physics.arcade.collide(player, layer);//碰撞检测

                player.body.velocity.x = 0;
                if(cursors.up.isDown){
                    if(player.body.onFloor()){
                        player.body.velocity.y = -250;
                    }
                }
                if(cursors.right.isDown){
                    player.body.velocity.x = 250;
                }
                if(cursors.left.isDown){
                    player.body.velocity.x = -250;
                }


            }
        }

        game.state.add('state1',state);
        game.state.start('state1');


    </script>
</body>
</html>